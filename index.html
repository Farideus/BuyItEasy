<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Игра с Красным Шариком</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #87CEEB; /* голубое небо */
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: linear-gradient(to top, #3a3a3a, #87CEEB);
    border: 2px solid #333;
  }
  #info {
    text-align: center;
    color: #333;
    font-family: Arial, sans-serif;
    margin: 5px;
  }
</style>
</head>
<body>

<div id="info">Используйте стрелки ← и → для движения, пробел — прыжок</div>
<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
const groundHeight = 80;

let keys = {};

// Шарик - персонаж
class Ball {
  constructor() {
    this.radius = 25;
    this.x = 100;
    this.y = canvas.height - groundHeight - this.radius;
    this.vx = 0;
    this.vy = 0;
    this.color = "red";
    this.onGround = true;
    this.score = 0;
  }
  update() {
    // движение
    this.x += this.vx;

    // гравитация и прыжок
    this.vy += gravity;
    this.y += this.vy;

    // проверка земли
    if (this.y > canvas.height - groundHeight - this.radius) {
      this.y = canvas.height - groundHeight - this.radius;
      this.vy = 0;
      this.onGround = true;
    }
  }
  draw() {
    // тело шарика
    ctx.beginPath();
    ctx.fillStyle = this.color;
    ctx.shadowColor = "rgba(255,0,0,0.6)";
    ctx.shadowBlur = 15;
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    // лицо (глаза и улыбка)
    // глаза
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.ellipse(this.x - 10, this.y - 5, 6, 8, 0, 0, Math.PI * 2);
    ctx.ellipse(this.x + 10, this.y - 5, 6, 8, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.ellipse(this.x - 10, this.y - 5, 3, 5, 0, 0, Math.PI * 2);
    ctx.ellipse(this.x + 10, this.y - 5, 3, 5, 0, 0, Math.PI * 2);
    ctx.fill();

    // улыбка
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.lineWidth = 3;
    ctx.arc(this.x, this.y + 8, 12, 0, Math.PI);
    ctx.stroke();
  }
}

// Зубастый куб (препятствие)
class EnemyCube {
  constructor(x, y, size = 50) {
    this.x = x;
    this.y = y;
    this.size = size;
    this.color = "#555555";
  }
  draw() {
    // куб
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.size, this.size);

    // зубы - сверху и снизу зубчатые треугольники
    ctx.fillStyle = "#888888";
    const toothSize = 8;

    // сверху
    for (let i = 0; i < this.size; i += toothSize * 2) {
      ctx.beginPath();
      ctx.moveTo(this.x + i, this.y);
      ctx.lineTo(this.x + i + toothSize, this.y - toothSize);
      ctx.lineTo(this.x + i + toothSize * 2, this.y);
      ctx.closePath();
      ctx.fill();
    }

    // снизу
    for (let i = 0; i < this.size; i += toothSize * 2) {
      ctx.beginPath();
      ctx.moveTo(this.x + i, this.y + this.size);
      ctx.lineTo(this.x + i + toothSize, this.y + this.size + toothSize);
      ctx.lineTo(this.x + i + toothSize * 2, this.y + this.size);
      ctx.closePath();
      ctx.fill();
    }

    // "глаза" (чёрные квадраты сверху)
    ctx.fillStyle = "black";
    ctx.fillRect(this.x + 10, this.y + 10, 10, 10);
    ctx.fillRect(this.x + this.size - 20, this.y + 10, 10, 10);
  }
  getRect() {
    return {x: this.x, y: this.y, width: this.size, height: this.size};
  }
}

// Монетка
class Coin {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.radius = 10;
    this.color = "gold";
    this.collected = false;
  }
  draw() {
    if (this.collected) return;
    ctx.beginPath();
    ctx.fillStyle = this.color;
    ctx.shadowColor = "gold";
    ctx.shadowBlur = 15;
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    // небольшой отблеск
    ctx.beginPath();
    ctx.strokeStyle = "yellow";
    ctx.lineWidth = 2;
    ctx.arc(this.x - 3, this.y - 3, 6, 0, Math.PI * 2);
    ctx.stroke();
  }
  getRect() {
    return {
      x: this.x - this.radius,
      y: this.y - this.radius,
      width: this.radius * 2,
      height: this.radius * 2,
    };
  }
}

// Проверка пересечения прямоугольников (AABB)
function isColliding(r1, r2) {
  return (
    r1.x < r2.x + r2.width &&
    r1.x + r1.width > r2.x &&
    r1.y < r2.y + r2.height &&
    r1.y + r1.height > r2.y
  );
}

// Игра
class Game {
  constructor() {
    this.ball = new Ball();

    // Уровни — массив массивов с объектами врагов и монет
    this.levels = [
      {
        enemies: [
          new EnemyCube(400, canvas.height - groundHeight - 50),
          new EnemyCube(600, canvas.height - groundHeight - 50),
        ],
        coins: [
          new Coin(300, canvas.height - groundHeight - 40),
          new Coin(500, canvas.height - groundHeight - 40),
          new Coin(700, canvas.height - groundHeight - 40),
        ],
      },
      {
        enemies: [
          new EnemyCube(350, canvas.height - groundHeight - 50),
          new EnemyCube(550, canvas.height - groundHeight - 50),
          new EnemyCube(750, canvas.height - groundHeight - 50),
        ],
        coins: [
          new Coin(400, canvas.height - groundHeight - 120),
          new Coin(650, canvas.height - groundHeight - 40),
          new Coin(800, canvas.height - groundHeight - 100),
        ],
      },
      // Можно добавить еще уровни
    ];

    this.currentLevelIndex = 0;
    this.enemies = this.levels[this.currentLevelIndex].enemies;
    this.coins = this.levels[this.currentLevelIndex].coins;

    this.gameOver = false;
    this.levelCompleted = false;
  }

  nextLevel() {
    this.currentLevelIndex++;
    if (this.currentLevelIndex >= this.levels.length) {
      alert("Поздравляем! Вы прошли все уровни!");
      this.resetGame();
    } else {
      this.enemies = this.levels[this.currentLevelIndex].enemies;
      this.coins = this.levels[this.currentLevelIndex].coins;
      this.ball.x = 100;
      this.ball.y = canvas.height - groundHeight - this.ball.radius;
      this.ball.vx = 0;
      this.ball.vy = 0;
      this.ball.onGround = true;
      this.levelCompleted = false;
      this.gameOver = false;
    }
  }

  resetGame() {
    this.currentLevelIndex = 0;
    this.enemies = this.levels[0].enemies;
    this.coins = this.levels[0].coins;
    this.ball.x = 100;
    this.ball.y = canvas.height - groundHeight - this.ball.radius;
    this.ball.vx = 0;
    this.ball.vy = 0;
    this.ball.onGround = true;
    this.ball.score = 0;
    this.gameOver = false;
    this.levelCompleted = false;
  }

  update() {
    if (this.gameOver || this.levelCompleted) return;

    // Управление шариком
    if (keys["ArrowLeft"]) {
      this.ball.vx = -5;
    } else if (keys["ArrowRight"]) {
      this.ball.vx = 5;
    } else {
      this.ball.vx = 0;
    }

    // Прыжок
    if (keys[" "] && this.ball.onGround) {
      this.ball.vy = -15;
      this.ball.onGround = false;
    }

    this.ball.update();

    // Проверка столкновений с врагами
    const ballRect = {
      x: this.ball.x - this.ball.radius,
      y: this.ball.y - this.ball.radius,
      width: this.ball.radius * 2,
      height: this.ball.radius * 2,
    };
    for (const enemy of this.enemies) {
      if (isColliding(ballRect, enemy.getRect())) {
        this.gameOver = true;
        break;
      }
    }

    // Проверка сбора монет
    for (const coin of this.coins) {
      if (!coin.collected && isColliding(ballRect, coin.getRect())) {
        coin.collected = true;
        this.ball.score += 1;
      }
    }

    // Проверка прохождения уровня (если все монетки собраны)
    if (this.coins.every(c => c.collected)) {
      this.levelCompleted = true;
      setTimeout(() => this.nextLevel(), 1500);
    }
  }

  drawGround() {
    ctx.fillStyle = "#654321";
    ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);
  }

  draw() {
    // очистка
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // фон (небо)
    let grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, "#87CEEB");
    grad.addColorStop(1, "#654321");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    this.drawGround();

    // враги
    this.enemies.forEach(enemy => enemy.draw());

    // монеты
    this.coins.forEach(coin => coin.draw());

    // шарик
    this.ball.draw();

    // очки
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("Монетки: " + this.ball.score, 10, 30);

    if (this.gameOver) {
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "50px Arial";
      ctx.fillText("Вы проиграли!", canvas.width / 2 - 140, canvas.height / 2);
      ctx.font = "30px Arial";
      ctx.fillText("Обновите страницу, чтобы начать заново", canvas.width / 2 - 210, canvas.height / 2 + 40);
    }

    if (this.levelCompleted) {
      ctx.fillStyle = "rgba(255,255,255,0.7)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "green";
      ctx.font = "40px Arial";
      ctx.fillText("Уровень пройден!", canvas.width / 2 - 140, canvas.height / 2);
    }
  }
}

const game = new Game();

function gameLoop() {
  game.update();
  game.draw();
  requestAnimationFrame(gameLoop);
}

window.addEventListener("keydown", (e) => {
  if (e.code === "Space") e.preventDefault(); // чтобы не скроллило вниз
  keys[e.key] = true;
});
window.addEventListener("keyup", (e) => {
  keys[e.key] = false;
});

gameLoop();
</script>

</body>
</html>
